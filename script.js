const translations = {
    en: {
        languages: "Languages",
        super_spicy: "Super Spicy ðŸŒ¶ï¸",
        drink_or: "Truth, drink or",
        do: "Do",
        next_question: "Next Question",
        close: "Close",
        questions: [
            "Never have I ever faked a phone call to get out of a conversation.",
            "Never have I ever stalked an ex on social media.",
        ],
        superSpicyQuestions: [
            "Never have I ever sent a nude.",
            "Never have I ever had a threesome.",
        ],
        actions: [
            "Do 10 pushups.",
            "Sing a song chosen by the other players.",
        ],
        superSpicyActions: [
            "Take a body shot off the person of your choice.",
            "Give a 2-minute massage to the person to your left.",
        ]
    },
    fr: {
        languages: "Langues",
        super_spicy: "Super PimentÃ© ðŸŒ¶ï¸",
        drink_or: "VÃ©ritÃ©, bois ou",
        do: "Action",
        next_question: "Question Suivante",
        close: "Fermer",
        questions: [
            "Je n'ai jamais fait semblant de recevoir un appel pour quitter une conversation.",
            "Je n'ai jamais espionnÃ© un ex sur les rÃ©seaux sociaux.",
        ],
        superSpicyQuestions: [
            "Je n'ai jamais envoyÃ© de nu.",
            "Je n'ai jamais fait de plan Ã  three.",
        ],
        actions: [
            "Fais 10 pompes.",
            "Chante une chanson choisie par les autres joueurs.",
        ],
        superSpicyActions: [
            "Prends un body shot sur la personne de ton choix.",
            "Fais un massage de 2 minutes Ã  la personne Ã  ta gauche.",
        ]
    },
    es: {
        languages: "Idiomas",
        super_spicy: "Super Picante ðŸŒ¶ï¸",
        drink_or: "Verdad, bebe o",
        do: "AcciÃ³n",
        next_question: "Siguiente Pregunta",
        close: "Cerrar",
        questions: [
            "Nunca he fingido una llamada para salir de una conversaciÃ³n.",
            "Nunca he acosado a un ex en las redes sociales.",
        ],
        superSpicyQuestions: [
            "Nunca he enviado un desnudo.",
            "Nunca he tenido un trÃ­o.",
        ],
        actions: [
            "Haz 10 flexiones.",
            "Canta una canciÃ³n elegida por los demÃ¡s jugadores.",
        ],
        superSpicyActions: [
            "Toma un chupito del cuerpo de la persona que elijas.",
            "Da un masaje de 2 minutos a la persona a tu izquierda.",
        ]
    },
    ar: {
        languages: "Ù„ØºØ§Øª",
        super_spicy: "Ø­Ø§Ø± Ø¬Ø¯Ø§ ðŸŒ¶ï¸",
        drink_or: "Ø­Ù‚ÙŠÙ‚Ø©ØŒ Ø§Ø´Ø±Ø¨ Ø£Ùˆ",
        do: "ÙØ¹Ù„",
        next_question: "Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ",
        close: "Ø¥ØºÙ„Ø§Ù‚",
        questions: [
            "Ù„Ù… ÙŠØ³Ø¨Ù‚ Ù„ÙŠ Ø£Ù† ØªØ¸Ø§Ù‡Ø±Øª Ø¨Ù…ÙƒØ§Ù„Ù…Ø© Ù‡Ø§ØªÙÙŠØ© Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ø­Ø§Ø¯Ø«Ø©.",
            "Ù„Ù… ÙŠØ³Ø¨Ù‚ Ù„ÙŠ Ø£Ù† Ø·Ø§Ø±Ø¯Øª Ø­Ø¨ÙŠØ¨Ø§Ù‹ Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ø¹Ù„Ù‰ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ.",
        ],
        superSpicyQuestions: [
            "Ù„Ù… ÙŠØ³Ø¨Ù‚ Ù„ÙŠ Ø£Ù† Ø£Ø±Ø³Ù„Øª ØµÙˆØ±Ø© Ø¹Ø§Ø±ÙŠØ©.",
            "Ù„Ù… ÙŠØ³Ø¨Ù‚ Ù„ÙŠ Ø£Ù† Ø£Ù‚Ù…Øª Ø¹Ù„Ø§Ù‚Ø© Ø«Ù„Ø§Ø«ÙŠØ©.",
        ],
        actions: [
            "Ù‚Ù… Ø¨Ø¹Ù…Ù„ 10 ØªÙ…Ø±ÙŠÙ†Ø§Øª Ø¶ØºØ·.",
            "ØºÙ† Ø£ØºÙ†ÙŠØ© ÙŠØ®ØªØ§Ø±Ù‡Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø¢Ø®Ø±ÙˆÙ†.",
        ],
        superSpicyActions: [
            "Ø®Ø° Ø¬Ø±Ø¹Ø© Ù…Ù† Ø¬Ø³Ø¯ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªØ®ØªØ§Ø±Ù‡.",
            "Ù‚Ù… Ø¨ØªØ¯Ù„ÙŠÙƒ Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø±Ùƒ.",
        ]
    },
    zh: {
        languages: "è¯­è¨€",
        super_spicy: "è¶…çº§è¾£ ðŸŒ¶ï¸",
        drink_or: "çœŸå¿ƒè¯ï¼Œå–é…’æˆ–",
        do: "åš",
        next_question: "ä¸‹ä¸€ä¸ªé—®é¢˜",
        close: "å…³é—­",
        questions: [
            "æˆ‘ä»Žæ¥æ²¡æœ‰å‡è£…æ‰“ç”µè¯æ¥æ‘†è„±è°ˆè¯ã€‚",
            "æˆ‘ä»Žæ¥æ²¡æœ‰åœ¨ç¤¾äº¤åª’ä½“ä¸Šè·Ÿè¸ªè¿‡å‰ä»»ã€‚",
        ],
        superSpicyQuestions: [
            "æˆ‘ä»Žæ¥æ²¡æœ‰å‘è¿‡è£¸ç…§ã€‚",
            "æˆ‘ä»Žæ¥æ²¡æœ‰çŽ©è¿‡ä¸‰äººè¡Œã€‚",
        ],
        actions: [
            "åš10ä¸ªä¿¯å§æ’‘ã€‚",
            "å”±ä¸€é¦–å…¶ä»–çŽ©å®¶é€‰æ‹©çš„æ­Œæ›²ã€‚",
        ],
        superSpicyActions: [
            "ä»Žä½ é€‰æ‹©çš„äººèº«ä¸Šå–ä¸€æ¯ã€‚",
            "ç»™ä½ å·¦è¾¹çš„äººåš2åˆ†é’Ÿçš„æŒ‰æ‘©ã€‚",
        ]
    }
};

let currentLanguage = 'en';

const questionText = document.getElementById('question-text');
const nextQuestionButton = document.getElementById('next-question');
const choicesContainer = document.getElementById('choices');
const doButton = document.getElementById('do-button');
const actionModal = document.getElementById('action-modal');
const actionText = document.getElementById('action-text');
const closeModalButton = document.getElementById('close-modal');
const card = document.querySelector('.card');
const langMenuButton = document.getElementById('lang-menu-button');
const langModal = document.getElementById('lang-modal');
const closeLangModalButton = document.getElementById('close-lang-modal');

let lastQuestionIndex = -1;
let lastActionIndex = -1;
let lastSpicyQuestionIndex = -1;
let lastSpicyActionIndex = -1;

let isSpicy = false;
let questionCounter = 0;
let nextSpicy = Math.floor(Math.random() * 3) + 3; // 3 to 5

function t(key) {
    return translations[currentLanguage][key];
}

function updateUIText() {
    document.querySelectorAll('[data-i18n-key]').forEach(element => {
        const key = element.getAttribute('data-i18n-key');
        element.innerText = t(key);
    });
}

function getNewQuestion() {
    questionCounter++;
    if (questionCounter >= nextSpicy) {
        questionCounter = 0;
        nextSpicy = Math.floor(Math.random() * 3) + 3;
        isSpicy = true;
        let newSpicyQuestionIndex;
        do {
            newSpicyQuestionIndex = Math.floor(Math.random() * t('superSpicyQuestions').length);
        } while (newSpicyQuestionIndex === lastSpicyQuestionIndex);
        lastSpicyQuestionIndex = newSpicyQuestionIndex;
        return t('superSpicyQuestions')[newSpicyQuestionIndex];
    } else {
        isSpicy = false;
        let newQuestionIndex;
        do {
            newQuestionIndex = Math.floor(Math.random() * t('questions').length);
        } while (newQuestionIndex === lastQuestionIndex);
        lastQuestionIndex = newQuestionIndex;
        return t('questions')[newQuestionIndex];
    }
}

function getNewAction() {
    if (isSpicy) {
        let newSpicyActionIndex;
        do {
            newSpicyActionIndex = Math.floor(Math.random() * t('superSpicyActions').length);
        } while (newSpicyActionIndex === lastSpicyActionIndex);
        lastSpicyActionIndex = newSpicyActionIndex;
        return t('superSpicyActions')[newSpicyActionIndex];
    } else {
        let newActionIndex;
        do {
            newActionIndex = Math.floor(Math.random() * t('actions').length);
        } while (newActionIndex === lastActionIndex);
        lastActionIndex = newActionIndex;
        return t('actions')[newActionIndex];
    }
}

function displayNewQuestion() {
    questionText.classList.add('fade');
    choicesContainer.classList.add('hidden');
    actionModal.classList.add('hidden');
    card.classList.remove('super-spicy', 'glitch');

    setTimeout(() => {
        questionText.innerText = getNewQuestion();
        if (isSpicy) {
            card.classList.add('super-spicy');
            card.classList.add('glitch');
        }
        questionText.classList.remove('fade');
        choicesContainer.classList.remove('hidden');
    }, 500); // Match the CSS transition time
}

function setLanguage(lang) {
    currentLanguage = lang;
    if (lang === 'ar') {
        document.body.classList.add('rtl');
    } else {
        document.body.classList.remove('rtl');
    }
    updateUIText();
    displayNewQuestion();
    langModal.classList.add('hidden');
}

langMenuButton.addEventListener('click', () => {
    langModal.classList.remove('hidden');
});

closeLangModalButton.addEventListener('click', () => {
    langModal.classList.add('hidden');
});

document.querySelectorAll('.lang-select').forEach(button => {
    button.addEventListener('click', () => {
        setLanguage(button.getAttribute('data-lang'));
    });
});

doButton.addEventListener('click', () => {
    actionText.innerText = getNewAction();
    actionModal.classList.remove('hidden');
});

closeModalButton.addEventListener('click', () => {
    actionModal.classList.add('hidden');
});

nextQuestionButton.addEventListener('click', displayNewQuestion);

// Initial setup
updateUIText();
displayNewQuestion();
